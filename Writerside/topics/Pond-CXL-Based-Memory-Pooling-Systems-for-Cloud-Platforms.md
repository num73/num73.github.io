# Pond: CXL-Based Memory Pooling Systems for Cloud Platforms

## 研究动机

云服务厂商希望在满足严格的性能约束的条件下降低硬件成本。性能和成本的一个关键因素就是主存（在Azure内存成本占了50%）。作者发现当cpu资源利用率足够高时，有多达25%的DRAM成为被搁浅的(stranded)，被浪费掉了。现有的减少这类被搁浅的内存的技术都会使内存访问增加微秒级的延迟，从而对性能造成很大的影响。CXL标准的提出，使得处理器访问池化内存(pooled memory)的延迟减少到纳秒级别，让内存池技术应用的真正实施变得可行，可以减少云服务商在DRAM上花费的成本。

## 研究意义

Pond是第一个基于CXL的内存池技术。Pond内存池技术在满足云服务商的性能要求的基础上可以让云服务商花在内存上的成本大幅减少（作者在158个workload上的测试评估显示，在不超过5%的性能损失条件下减少了7%的内存成本），对于大型的云服务提供商来说可以减少数亿的成本。

## 设计概述

作者通过增加新的硬件external memory controller(EMC)来实现内存池，EMC通过CXL与DDR5相连，同时提供多个CXL端口连接主机。对于主机来说EMC就是一个zNUMA，VM会优先申请本地内存。增加Pool Manager(PM)，PM通过低功耗的管理总线与EMC和CPU相连，负责内存池的管理。

基于CXL的内存池技术会增加对内存访问的延迟（几十纳秒左右），作者发现不同的workload对延迟的敏感程度不同，即不同的workload在增加内存访问延迟时，性能下降程度不同。有一些workload（25%左右）在访问延迟增加时只产生1%以下的性能损失，但有些workload会产生超过25%的性能损失(Figure 4)。

![image-20240425163332859](image-20240802170903625.png)

同时，作者在对Azure的内存使用情况的研究中发现有超过50%的虚拟机存在超过20%的未使用的内存(untouched momory)，如果把这些内存拿出来作为内存池中的内存，对性能几乎没有影响。

所以在Pond使用了两个策略来保证在减少内存使用的时候保证性能约束：

1. local memory和pooled memory同时使用，对于延迟不敏感的workload，只使用pooled memory，否则只把untouched memory放到内存池中，从内存池中申请。其中是否对延迟敏感和untouched momory的内存容量使用机器学习算法预测。

2. 设置QoS监视器，识别出哪些worload发生了可接受范围外的性能下降，如果检测到当前workload出现了严重的性能下降，将触发mitigation机制，重新配置内存，使VM只访问本地内存。