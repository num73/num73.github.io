# File System Semantics Requirements of HPC Applications

## 研究动机

许多广泛部署的并行文件系统（PFS）都实现了POSIX语义，但是严格遵循POSIX语义阻碍了性能的提高，有一些新的PFS使用更弱的文件一致性语义达到了更高的性能，但是目前并没有系统性的研究来确保应用可以在更弱的一致性语义上正确的运行。这种研究的缺失导致HPC系统的设计者在选择PFS时可能会过于保守，不能让系统达到更好的性能，作者的工作就是要填补这样的空白。

## 研究意义

作者对各种PFS的一致性语义进行了分类，并设计算法来确定各种HPC应用需要的一致性语义。作者对17种HPC应用的I/O活动进行了分析，发现其中16种应用可以使用更弱的一致性语义。HPC用户可以根据作者设计的算法或者已有的分析情况选择合适的PFS。

## 设计概述

文章的目的是提供一个方法可以测试HPC应用的一致性语义的需求。

为了达成这一目的作者首先将一致性语义分为了不同的等级，设计检测i/o冲突的算法，收集i/o数据，然后根据收集到的I/O操作的数据测试了多种PFS在不同的一致性语义级别下的冲突情况。

### 一致性语义的分类（Categorization Of Consistency Sementices）

1. **强一致性语义（Strong Consistency Semantics）**: write调用做出的修改对接下来的所有的read调用可见。

2. **确认一致性语义（Commit Consistency Semantics）**: 对文件的修改在调用‘commit’后对所有的进程可见。

3. **会话一致性语义（Session Consistency Semantics）**：当前修改文件的进程显式关闭文件后，文件的修改对后来打开文件的进程可见。

4. **最终一致性语义（Eventual Consistency Semantics）**：对于文件的修改最终可以对所有进程可见。

##### 检测重叠（Overlap）和冲突（Conflit）

当两个I/O操作访问一个文件的同一个位置时就发生了重叠。如果这两个操作中有一个是读操作，那么这两个操作就产生了冲突。

1. 检测重叠算法

   记录每一个文件操作的起始和结束的偏移量分别记为$os$，$oe$。如果两个操作的偏移量$(os_1, oe_1)$和$(os_2, oe_2)$发成了重叠，即满足条件$os_1 \leq os_2 \leq oe_1或os_1 \leq oe_2 \leq oe_1$则两个操作发生了重叠。

2. 检测冲突算法

   将文件操作表示未一个元组(tuple)，即$(t, r, os, oe, type)$，其中$t$表示时间戳，$r$表示进程的标识，$os$和$oe$分别标识操作的起始和结束偏移量，$type$标识操作类型(read或write)。

   如果两个操作$(t_1, r_1, os_1, oe_1, type_1)$和$(t_2, r_2, os_2, oe_2, type_2)$其中$t_1 < t_2$发生了冲突，当且仅当这两个操作满足下面的所有条件：

    * 这两个操作重叠。

    * 第一个操作是写操作。

    * 对于确认一致性语义还需要保证：进程$r_1$在$t_1$和$t_2$之间没有执行任何commit操作。

    * 对于会话一致性语义需保证：进程$r_1$之后任何关闭操作的时间$t_c$和进程$r_2$任何打开操作的时间$t_o$都不满足$t_1 < t_c < t_o < t_2$​。